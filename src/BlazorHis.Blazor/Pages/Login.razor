@using System.ComponentModel.DataAnnotations;
@using System.Text.Json;
@using BlazorHis.Login;
@inject HttpClient Http

<Form Model="@model"
      OnFinish="OnFinish"
      OnFinishFailed="OnFinishFailed"
      LabelColSpan="8"
      WrapperColSpan="16">
    <FormItem Label="用户名">
        <Input @bind-Value="@context.userNameOrEmailAddress" />
    </FormItem>
    <FormItem Label="密码">
        <InputPassword @bind-Value="@context.password" />
    </FormItem>
    <FormItem WrapperColOffset="8" WrapperColSpan="16">
        <Checkbox @bind-Value="context.rememberMe">Remember me</Checkbox>
    </FormItem>
    <FormItem WrapperColOffset="8" WrapperColSpan="16">
        <Button Type="@ButtonType.Primary" HtmlType="submit">
            Submit
        </Button>
    </FormItem>
</Form>
@code
{
    public class Model
    {
        [Required]
        public string userNameOrEmailAddress { get; set; }
        [Required]
        public string password { get; set; }
        public bool rememberMe { get; set; } = true;
    }
    [Parameter]
    public EventCallback<MouseEventArgs> OnClickCallback { get; set; }

    private int Value;
    private Model model = new Model();

    private async Task OnFinish(EditContext editContext)
    {
        var result = await Http.PostAsJsonAsync<Model>("https://localhost:44309/api/account/login", model);
        string resultContent = result.Content.ReadAsStringAsync().Result;

        Console.WriteLine($"Success:{JsonSerializer.Serialize(resultContent)}");
        if (JsonSerializer.Deserialize<LoginResponse>(resultContent).result == 1)
        {
            await OnClickCallback.InvokeAsync();
        }
    }

    private void OnFinishFailed(EditContext editContext)
    {
        Console.WriteLine($"Failed:{JsonSerializer.Serialize(model)}");
    }
}